name: Pipeline proposal approval automation

on:
  issues:
    types: [opened, closed, labeled, unlabeled]
  issue_comment:
    types: [created, edited]

jobs:
  pipeline_approval:
    # Only run for pipeline proposal issues
    if: startsWith(github.event.issue.title, 'New pipeline')
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python with uv
        uses: astral-sh/setup-uv@v4
        with:
          enable-cache: true
          cache-local-path: .github/workflows/lib/.uv-cache

      - name: Install Python dependencies
        working-directory: .github/workflows/lib
        run: uv pip install . --system

      - name: Handle pipeline proposal approval logic
        working-directory: .github/workflows/lib
        run: |
          python scripts/pipeline_approval.py \
            --github-token="${{ secrets.nf_core_bot_auth_token }}" \
            --org="${{ github.repository_owner }}" \
            --repo="${{ github.event.repository.name }}" \
            --issue-number="${{ github.event.issue.number }}" \
            --event-name="${{ github.event_name }}" \
            --event-action="${{ github.event.action }}" \
            --issue-state="${{ github.event.issue.state }}" \
            --label-name="${{ github.event.label.name }}" \
            --issue-state-reason="${{ github.event.issue.state_reason }}"
